{% extends 'loja_app/base.html' %}
{% load static %}

{% block body_class %}dashboard-page{% endblock %}
{% block title %}Meu Histórico de Compras{% endblock %}

{% block extra_css %}<link rel="stylesheet" href="{% static 'loja_app/css/home.css' %}">{% endblock %}

{% block content %}
<div class="dashboard-simple-container">
    <div class="dashboard-simple-content" style="max-width: 1200px;">
        <h2>Meu Histórico de Compras</h2>
        
        {% comment %} Verifica primeiro se é admin {% endcomment %}
        {% if user.is_staff %}
            <p>Esta página é destinada apenas para visualização do histórico de compras de clientes.</p>
        
        {% comment %} Se não for admin, verifica se tem perfil {% endcomment %}
        {% elif not cliente_profile %}
            <p>Você não possui um perfil de cliente associado para visualizar compras.</p>
        
        {% comment %} Se for cliente com perfil, mostra a tabela {% endcomment %}
        {% else %}
            <table style="width: 100%; margin-top: 20px; text-align: left;">
                <thead>
                    <tr>
                        <th>ID Venda</th>
                        <th>Data</th>
                        <th>Valor Total</th>
                        <th>Status</th>
                        <th>Loja</th>
                    </tr>
                </thead>
                <tbody>
                    {% for venda in vendas %}
                    <tr>
                        <td>#{{ venda.id }}</td>
                        <td>{{ venda.data_venda|date:"d/m/Y H:i" }}</td>
                        <td>R$ {{ venda.valor_total }}</td>
                        <td>
                            <span class="status-{{ venda.status|lower }}">
                                {{ venda.get_status_display }}
                            </span>
                        </td>
                        <td>{{ venda.loja.nome|default:"-" }}</td>
                    </tr>
                    {% empty %}
                        {% comment %} ADICIONADO: Condição para mostrar a mensagem apenas para clientes {% endcomment %}
                        {% if not user.is_staff %}
                            <tr><td colspan="5">Você ainda não realizou nenhuma compra.</td></tr>
                        {% else %}
                             {% comment %} Para admins, se a lista estiver vazia, não mostra nada extra {% endcomment %}
                             <tr><td colspan="5"></td></tr> {% comment %} Linha vazia ou outra mensagem se preferir {% endcomment %}
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
        
        <div class="back-button-container" style="margin-top: 20px;">
            <a href="{% url 'dashboard' %}" class="botao">Voltar</a>
        </div>
    </div>
</div>
{% endblock %}